
<!doctype html>
<html>
<head>
  <link type= "text/css" rel= "stylesheet" href="styles/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.0/css/materialize.min.css">

  <title>Revelstoke</title>

</head>
<script src="scripts/script.js" type="text/JavaScript"></script>


<body> <!--onload="getName()"-->
<header>
  <h2>Revelstoke</h2>
  <h4>The Climbing Chat App</h4>
</header>

<div id = container>
  <div id="users">
    <p> Users</p>
    <ul id="user"> </ul>
  </div>

  <div id="rooms">
    <p> Rooms</p>
    <!--<input class="waves-effect waves-light btn" value="create a room"/>-->
    <!--<input type='button' value="create a new room"/>-->

    <ul class='createRoom'>
      <!--<li><a href="/room1.html">Find a Partner</a></li>
      <li> <a href="/room2.html">Find Equipment</a></li>
      <li><a href="/room3.html">Find a Ride</a></li> -->
      <li>
        <form class="col s12">
          <div class="input-field col s10">
            <input placeholder="Create a new room" id="custom-room-name" type="text" />
          </div>
        </form>

        <!--<input type="text" id= "custom-room-name" placeholder="Room Name"/></li>-->
      <li><input class="waves-effect waves-light btn createButton" onclick="createRoom()" value="Create Room" /></li>

      <br/>
      <!--<li><input type="button" id="create-room" class= 'createButton' onclick="createRoom()" value="Create Room"/></li>-->
      <li><input type="button" id= "newPartner" class= 'roomButton' value="Find a Partner" /></li>
      <li><input type="button" id="equipment" class= 'roomButton' value="Find Equipment" /> </li>
      <li><input type="button" id="carShare" class= 'roomButton' value ="Find a Ride" /></li>

      <div id="custom-rooms"></div>
      <li></li>
    </ul>
  </div>

<div id="messageBox">
  <h4></h4>
  <section>
    <ul id="messages"></ul>
  </section>

  <section id="form">
    <form class = "col s12">
      <div class="row input">
        <div class="input-field col s10">
          <input placeholder="Rock on..." id="m" type="text" />
        </div>
        <div class="col s2">
          <button class="waves-effect waves-light btn send">Send</button>
        </div>
      </div>
    </form>

  <br/>

  </section>
  </div>
</div>

<script src="scripts/script.js" type="text/JavaScript"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="/scripts/jquery-2.1.1.js"></script>

<script>
  var socket = io();

  var name = "";

  var createRoom= function(){
    var roomName = $("#custom-room-name").val();
    $('#custom-room-name').val('');
    socket.emit("createRoom", roomName);
  };

  socket.on('createdRoom', function(room){
    var roomBtn = $('<input class="roomButton">');
    roomBtn.val(room);
    roomBtn.attr("type","button");
    roomBtn.click(function(){
      console.log(room,"clicked");
      switchRoom(room)
    });

    $('#custom-rooms').append($('<li>').append(roomBtn));
  });

  var room = io.connect('/room');

  var switchRoom = function(rmname){
      var roomName = rmname;     //create a selector on the value name in the input so onclick we
      socket.emit('switchRoom', roomName);
    };

  $('.roomButton').click(function() {
      var rName = $(this).val();
      switchRoom(rName);
    }
  ); // this means we check the current selected element (so this case we are getting the value which was defined in the input tag)

  socket.on('users', function(users){// listen for when someone is connected to the server the users nickname
    for(i = users.length; i > -1; i--) {
      $('#user').append($('<div>').text(users[i]));
      //socket.emit('username', username[i]);
    }
    name = prompt('What is your name?');
    socket.emit('join', name); //notifies the server of new user

  });

  $('form').submit(function(){
    var date = new Date(); // this is a construction
    console.log("date is " + date); // tells me what i'm looking at
    if(date.getMinutes() < 10){ // because if the time was 1:02 it would return 1:2 I created an if/else to add in proper display!
      date = date.getHours() + ":0" + date.getMinutes();
    }else{
      date = date.getHours() + ":" + date.getMinutes();
    };
    socket.emit('chat message', name+ " " + date + ": " + $('#m').val());
    var msg = $('#m').val();
    $('#m').val(''); // this is to clear the msg bar
    return false;
  });
  socket.on('chat message', function(msg) {
    $('#messages').append($('<li>').text(msg));//['name']+ " (" + msg["date"] + "): " + msg['msg']));// submits msgs into the box and puts them below previous statements.
    $('#messages').animate({
      scrollTop: $('#messages').height()
    }, "slow"); // need to find out how to scroll bottom (hint: its not scrollBottom)
    console.log(msg);
  });
  socket.on('joined', function(username){
    $('#user').append($('<div>').text(username));
   /* $('#user').html(" "); //this clears the html in the user element and reloads :)
    for(i = username.length; i > -1; i--) {
      $('#user').append($('<div>').text(username[i]));
      //socket.emit('username', username[i]);
    };*/
  });
  socket.on('history', function(msgs){
    $('#messages').html(" ");
    if (msgs === null){
      return false;
    };
    for(i = msgs.length; i > -1; i--) {
      $('#messages').append($('<li>').text(msgs[i]));
    };
  });
</script>

</body>
</html>
